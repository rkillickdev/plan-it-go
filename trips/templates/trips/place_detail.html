{% extends "base.html" %}

{% load static %}

{% block content %}

<!-- Trip Summary -->
{% include 'includes/trip_header.html' %}

<!-- Place Summary Section -->
<section class="place-summary mb-5">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <div class="image-container p-4">
          <img src="{{ place.image }}" alt="{{ place.name }}" class="img-fluid">
        </div>
      </div>
      <div class="col-md-6">
        <div class="text-container p-4 d-flex flex-column justify-content-between h-100 text-center">
          <h2>{{ place.name }}</h2>
          <form class="d-inline" action="{% url 'toggle_place' trip.id place.id %}" method="POST">
            {% csrf_token %}
            {% if added %}
              <div class="vstack gap-3">
                <button type="submit" name="place_id" value="{{place.id}}" class="btn-trip-add"><i class="fa-solid fa-circle-minus fa-4x"></i></i></button>
                <p>Remove From Your Trip</p>
              </div>
            {% else %}
            <button type="submit" name="place_id" value="{{place.id}}" class="btn-trip-add"><i class="fa-solid fa-plus"></i></button>
            <span>Add To Your Trip</span>
            {% endif %}
          </form>
          <div class="justify-content-center">
            <a href="{% url 'trip_detail' trip.slug trip.id %}" class="btn btn-primary text-light button-link">More Recommendations</a>
          </div>
        </div>
      </div>
    </div>
    <div class="row">

    </div>
  </div>
</section>

<!-- Place Info Section-->
<section class="place-info">
  <div class="container">
    <!-- Place Info Tabs -->
    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" id="nav-details-tab" data-bs-toggle="tab" data-bs-target="#nav-details" type="button" role="tab" aria-controls="nav-details" aria-selected="true">Details</button>
        <button class="nav-link" id="nav-reviews-tab" data-bs-toggle="tab" data-bs-target="#nav-reviews" type="button" role="tab" aria-controls="nav-reviews" aria-selected="false">Reviews</button>
        <button class="nav-link" id="nav-gallery-tab" data-bs-toggle="tab" data-bs-target="#nav-gallery" type="button" role="tab" aria-controls="nav-gallery" aria-selected="false">Gallery</button>
      </div>
    </nav>
    <!-- Place Info Tab Content -->
    <div class="tab-content" id="nav-tabContent">
      <!-- Place Details Tab Content-->
      <div class="tab-pane fade show active" id="nav-details" role="tabpanel" aria-labelledby="nav-details-tab">
        <div class="row">
          <div class="col-12">
            <div class="text-container p-4 mb-2">
              <p class="lead">
                {{ place.description }}
              </p>
            </div>  
          </div>
        </div>
        <div class="row">
          <div class="col-md-8">
            <div class="map-container p-4">
              <div id="map"></div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="text-container p-4 d-flex flex-column justify-content-center h-100 mb-5">
              <h2 class="fw-bold"> Location</h2>
              {% for key, value in place.address.items %}
                {% if not value == "" %}
                  <p> {{ value }} </p> 
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
      <!-- Place Reviews Tab Content -->
      <div class="tab-pane fade py-4" id="nav-reviews" role="tabpanel" aria-labelledby="nav-reviews-tab">
        <!-- Review Carousel -->
        <div id="reviewCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            {% for review in reviews %}
              <div class="carousel-item {% if forloop.first %} active {% endif %}">
                <div class="d-flex flex-column justify-content-center align-items-center text-center">
                  <img src="{% static 'images/placeholders/globe-profile-face-compress-square.webp'%}" alt="" class="rounded-circle" width="120">
                  <p class="w-50 my-4 fst-italic fs-4 mb-4">
                    {{review.body}}    
                  </p>
                </div>
              </div>
            {% endfor %}
          </div>
          <!-- Carousel Buttons -->
          <button class="carousel-control-prev" type="button" data-bs-target="#reviewCarousel" data-bs-slide="prev">
            <i class="fas fa-arrow-circle-left fa-3x text-dark"></i>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#reviewCarousel" data-bs-slide="next">
            <i class="fas fa-arrow-circle-right fa-3x text-dark"></i>
          </button>
        </div>
      </div>
      <!-- Place Gallery Tab Content -->
      <div class="tab-pane fade" id="nav-gallery" role="tabpanel" aria-labelledby="nav-gallery-tab">
        <div class="row mt-4">
          {% for image in images %}
          <div class="col-md-4">
            <div class="image-container">
              <a data-bs-toggle="modal" data-bs-target="#modal1">
                <img src="{{ image.path.url }}" alt="" class="img-fluid img-size-consistent image-solo">    
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Image Modal -->
<div id="modal1" class="modal fade">
  <div class="modal-dialog modal-lg mt-7">
    <div class="modal-content bg-secondary p-5">
      <div class="row">
        <div class="col-12 d-flex flex-column justify-content-between">
          <img id="solo-modal-image" src="" alt="" class="img-fluid">
          <button class="btn btn-light" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extras %}

{% load static %}
{{ place.latitude|json_script:"latitude"}}
{{ place.longitude|json_script:"longitude"}}
{{ g_maps_api_key|json_script:"maps-api-key" }}
<script src="{% static 'js/maps.js' %}"></script>
<script src="{% static 'js/image-modal.js' %}"></script>

{% endblock extras %}